/**
 * This script needs to be run before other e2e mocha scripts
 *
 * This script starts the server or if it's TestObject, runs the tests on TO server
 */
'use strict';

var _regeneratorRuntime = require('babel-runtime/regenerator')['default'];

var _interopRequireDefault = require('babel-runtime/helpers/interop-require-default')['default'];

var _appiumTestSupport = require('appium-test-support');

var _wd = require('wd');

var _wd2 = _interopRequireDefault(_wd);

var _ = require('../../..');

var _libLogger = require('../../../lib/logger');

var _libLogger2 = _interopRequireDefault(_libLogger);

if (process.env.TESTOBJECT_E2E_TESTS) {
  (function () {
    _libLogger2['default'].debug('Running tests on TestObject');

    var wdObject = undefined;
    before(function callee$1$0() {
      var commit;
      return _regeneratorRuntime.async(function callee$1$0$(context$2$0) {
        while (1) switch (context$2$0.prev = context$2$0.next) {
          case 0:
            commit = process.env.COMMIT_HASH || process.env.APPVEYOR_REPO_COMMIT || process.env.TRAVIS_COMMIT;

            if (commit) {
              context$2$0.next = 3;
              break;
            }

            throw new Error('A commit must be provided in $COMMIT_HASH');

          case 3:
            context$2$0.next = 5;
            return _regeneratorRuntime.awrap((0, _appiumTestSupport.enableTestObject)(_wd2['default'], 'appium-uiautomator2-driver', 'https://github.com/appium/appium-uiautomator2-driver.git', commit));

          case 5:
            wdObject = context$2$0.sent;

          case 6:
          case 'end':
            return context$2$0.stop();
        }
      }, null, this);
    });
    after(function callee$1$0() {
      return _regeneratorRuntime.async(function callee$1$0$(context$2$0) {
        while (1) switch (context$2$0.prev = context$2$0.next) {
          case 0:
            context$2$0.next = 2;
            return _regeneratorRuntime.awrap((0, _appiumTestSupport.disableTestObject)(wdObject));

          case 2:
          case 'end':
            return context$2$0.stop();
        }
      }, null, this);
    });
  })();
} else {
  before(function callee$0$0() {
    return _regeneratorRuntime.async(function callee$0$0$(context$1$0) {
      while (1) switch (context$1$0.prev = context$1$0.next) {
        case 0:
          context$1$0.next = 2;
          return _regeneratorRuntime.awrap((0, _.startServer)(_.DEFAULT_PORT, 'localhost'));

        case 2:
        case 'end':
          return context$1$0.stop();
      }
    }, null, this);
  });
}
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInRlc3QvZnVuY3Rpb25hbC9oZWxwZXJzL21vY2hhLXNjcmlwdHMuanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7aUNBS29ELHFCQUFxQjs7a0JBQzFELElBQUk7Ozs7Z0JBQ3VCLFVBQVU7O3lCQUNqQyxxQkFBcUI7Ozs7QUFFeEMsSUFBSSxPQUFPLENBQUMsR0FBRyxDQUFDLG9CQUFvQixFQUFFOztBQUNwQywyQkFBTyxLQUFLLENBQUMsNkJBQTZCLENBQUMsQ0FBQzs7QUFFNUMsUUFBSSxRQUFRLFlBQUEsQ0FBQztBQUNiLFVBQU0sQ0FBQztVQUNDLE1BQU07Ozs7QUFBTixrQkFBTSxHQUFHLE9BQU8sQ0FBQyxHQUFHLENBQUMsV0FBVyxJQUFJLE9BQU8sQ0FBQyxHQUFHLENBQUMsb0JBQW9CLElBQUksT0FBTyxDQUFDLEdBQUcsQ0FBQyxhQUFhOztnQkFDbEcsTUFBTTs7Ozs7a0JBQ0gsSUFBSSxLQUFLLDZDQUE2Qzs7Ozs2Q0FFN0MsMERBQXFCLDRCQUE0Qiw4REFBOEQsTUFBTSxDQUFDOzs7QUFBdkksb0JBQVE7Ozs7Ozs7S0FDVCxDQUFDLENBQUM7QUFDSCxTQUFLLENBQUM7Ozs7OzZDQUNFLDBDQUFrQixRQUFRLENBQUM7Ozs7Ozs7S0FDbEMsQ0FBQyxDQUFDOztDQUVKLE1BQU07QUFDTCxRQUFNLENBQUM7Ozs7OzJDQUNDLG1DQUEwQixXQUFXLENBQUM7Ozs7Ozs7R0FDN0MsQ0FBQyxDQUFDO0NBQ0oiLCJmaWxlIjoidGVzdC9mdW5jdGlvbmFsL2hlbHBlcnMvbW9jaGEtc2NyaXB0cy5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogVGhpcyBzY3JpcHQgbmVlZHMgdG8gYmUgcnVuIGJlZm9yZSBvdGhlciBlMmUgbW9jaGEgc2NyaXB0c1xuICpcbiAqIFRoaXMgc2NyaXB0IHN0YXJ0cyB0aGUgc2VydmVyIG9yIGlmIGl0J3MgVGVzdE9iamVjdCwgcnVucyB0aGUgdGVzdHMgb24gVE8gc2VydmVyXG4gKi9cbmltcG9ydCB7IGVuYWJsZVRlc3RPYmplY3QsIGRpc2FibGVUZXN0T2JqZWN0IH0gZnJvbSAnYXBwaXVtLXRlc3Qtc3VwcG9ydCc7XG5pbXBvcnQgd2QgZnJvbSAnd2QnO1xuaW1wb3J0IHsgc3RhcnRTZXJ2ZXIsIERFRkFVTFRfUE9SVCB9IGZyb20gJy4uLy4uLy4uJztcbmltcG9ydCBsb2dnZXIgZnJvbSAnLi4vLi4vLi4vbGliL2xvZ2dlcic7XG5cbmlmIChwcm9jZXNzLmVudi5URVNUT0JKRUNUX0UyRV9URVNUUykge1xuICBsb2dnZXIuZGVidWcoJ1J1bm5pbmcgdGVzdHMgb24gVGVzdE9iamVjdCcpO1xuXG4gIGxldCB3ZE9iamVjdDtcbiAgYmVmb3JlKGFzeW5jIGZ1bmN0aW9uICgpIHtcbiAgICBjb25zdCBjb21taXQgPSBwcm9jZXNzLmVudi5DT01NSVRfSEFTSCB8fCBwcm9jZXNzLmVudi5BUFBWRVlPUl9SRVBPX0NPTU1JVCB8fCBwcm9jZXNzLmVudi5UUkFWSVNfQ09NTUlUO1xuICAgIGlmICghY29tbWl0KSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoYEEgY29tbWl0IG11c3QgYmUgcHJvdmlkZWQgaW4gJENPTU1JVF9IQVNIYCk7XG4gICAgfVxuICAgIHdkT2JqZWN0ID0gYXdhaXQgZW5hYmxlVGVzdE9iamVjdCh3ZCwgJ2FwcGl1bS11aWF1dG9tYXRvcjItZHJpdmVyJywgYGh0dHBzOi8vZ2l0aHViLmNvbS9hcHBpdW0vYXBwaXVtLXVpYXV0b21hdG9yMi1kcml2ZXIuZ2l0YCwgY29tbWl0KTtcbiAgfSk7XG4gIGFmdGVyKGFzeW5jIGZ1bmN0aW9uICgpIHtcbiAgICBhd2FpdCBkaXNhYmxlVGVzdE9iamVjdCh3ZE9iamVjdCk7XG4gIH0pO1xuXG59IGVsc2Uge1xuICBiZWZvcmUoYXN5bmMgZnVuY3Rpb24gKCkge1xuICAgIGF3YWl0IHN0YXJ0U2VydmVyKERFRkFVTFRfUE9SVCwgJ2xvY2FsaG9zdCcpO1xuICB9KTtcbn1cbiJdLCJzb3VyY2VSb290IjoiLi4vLi4vLi4vLi4ifQ==
