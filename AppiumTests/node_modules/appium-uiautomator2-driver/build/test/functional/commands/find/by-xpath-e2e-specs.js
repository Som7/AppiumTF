'use strict';

var _regeneratorRuntime = require('babel-runtime/regenerator')['default'];

var _interopRequireDefault = require('babel-runtime/helpers/interop-require-default')['default'];

var _chai = require('chai');

var _chai2 = _interopRequireDefault(_chai);

var _chaiAsPromised = require('chai-as-promised');

var _chaiAsPromised2 = _interopRequireDefault(_chaiAsPromised);

var _desired = require('../../desired');

var _helpersSession = require('../../helpers/session');

_chai2['default'].should();
_chai2['default'].use(_chaiAsPromised2['default']);

var atv = 'android.widget.TextView';
var f = "android.widget.FrameLayout";

describe('Find - xpath', function () {
  var _this = this;

  var driver = undefined;
  before(function callee$1$0() {
    return _regeneratorRuntime.async(function callee$1$0$(context$2$0) {
      while (1) switch (context$2$0.prev = context$2$0.next) {
        case 0:
          context$2$0.next = 2;
          return _regeneratorRuntime.awrap((0, _helpersSession.initDriver)(_desired.APIDEMOS_CAPS));

        case 2:
          driver = context$2$0.sent;

        case 3:
        case 'end':
          return context$2$0.stop();
      }
    }, null, _this);
  });
  after(function callee$1$0() {
    return _regeneratorRuntime.async(function callee$1$0$(context$2$0) {
      while (1) switch (context$2$0.prev = context$2$0.next) {
        case 0:
          context$2$0.next = 2;
          return _regeneratorRuntime.awrap(driver.quit());

        case 2:
        case 'end':
          return context$2$0.stop();
      }
    }, null, _this);
  });
  it('should find element by type', function callee$1$0() {
    var el;
    return _regeneratorRuntime.async(function callee$1$0$(context$2$0) {
      while (1) switch (context$2$0.prev = context$2$0.next) {
        case 0:
          context$2$0.next = 2;
          return _regeneratorRuntime.awrap(driver.elementByXPath('//' + atv));

        case 2:
          el = context$2$0.sent;
          context$2$0.next = 5;
          return _regeneratorRuntime.awrap(el.text().should.eventually.equal('API Demos'));

        case 5:
        case 'end':
          return context$2$0.stop();
      }
    }, null, _this);
  });
  it('should find element by text', function callee$1$0() {
    var el;
    return _regeneratorRuntime.async(function callee$1$0$(context$2$0) {
      while (1) switch (context$2$0.prev = context$2$0.next) {
        case 0:
          context$2$0.next = 2;
          return _regeneratorRuntime.awrap(driver.elementByXPath('//' + atv + '[@text=\'Accessibility\']'));

        case 2:
          el = context$2$0.sent;
          context$2$0.next = 5;
          return _regeneratorRuntime.awrap(el.text().should.eventually.equal('Accessibility'));

        case 5:
        case 'end':
          return context$2$0.stop();
      }
    }, null, _this);
  });
  it('should find element by attribute', function callee$1$0() {
    return _regeneratorRuntime.async(function callee$1$0$(context$2$0) {
      while (1) switch (context$2$0.prev = context$2$0.next) {
        case 0:
          context$2$0.next = 2;
          return _regeneratorRuntime.awrap(driver.elementsByXPath('//*[@enabled=\'true\' and @focused=\'true\']').should.eventually.have.length(1));

        case 2:
        case 'end':
          return context$2$0.stop();
      }
    }, null, _this);
  });
  it('should find exactly one element via elementsByXPath', function callee$1$0() {
    var els;
    return _regeneratorRuntime.async(function callee$1$0$(context$2$0) {
      while (1) switch (context$2$0.prev = context$2$0.next) {
        case 0:
          context$2$0.next = 2;
          return _regeneratorRuntime.awrap(driver.elementsByXPath('//' + atv + '[@text=\'Accessibility\']'));

        case 2:
          els = context$2$0.sent;

          els.length.should.equal(1);
          context$2$0.next = 6;
          return _regeneratorRuntime.awrap(els[0].text().should.eventually.equal('Accessibility'));

        case 6:
        case 'end':
          return context$2$0.stop();
      }
    }, null, _this);
  });
  it('should find element by partial text', function callee$1$0() {
    var el;
    return _regeneratorRuntime.async(function callee$1$0$(context$2$0) {
      while (1) switch (context$2$0.prev = context$2$0.next) {
        case 0:
          context$2$0.next = 2;
          return _regeneratorRuntime.awrap(driver.elementByXPath('//' + atv + '[contains(@text, \'Accessibility\')]'));

        case 2:
          el = context$2$0.sent;
          context$2$0.next = 5;
          return _regeneratorRuntime.awrap(el.text().should.eventually.equal('Accessibility'));

        case 5:
        case 'end':
          return context$2$0.stop();
      }
    }, null, _this);
  });
  it('should find the last element', function callee$1$0() {
    var el, text;
    return _regeneratorRuntime.async(function callee$1$0$(context$2$0) {
      while (1) switch (context$2$0.prev = context$2$0.next) {
        case 0:
          context$2$0.next = 2;
          return _regeneratorRuntime.awrap(driver.elementByXPath('(//' + atv + ')[last()]'));

        case 2:
          el = context$2$0.sent;
          context$2$0.next = 5;
          return _regeneratorRuntime.awrap(el.text());

        case 5:
          text = context$2$0.sent;

          ["OS", "Text", "Views", "Preference"].should.include(text);

        case 7:
        case 'end':
          return context$2$0.stop();
      }
    }, null, _this);
  });
  it('should find element by index and embedded desc', function callee$1$0() {
    var el;
    return _regeneratorRuntime.async(function callee$1$0$(context$2$0) {
      while (1) switch (context$2$0.prev = context$2$0.next) {
        case 0:
          context$2$0.next = 2;
          return _regeneratorRuntime.awrap(driver.elementByXPath('//' + f + '//' + atv + '[5]'));

        case 2:
          el = context$2$0.sent;
          context$2$0.next = 5;
          return _regeneratorRuntime.awrap(el.text().should.eventually.equal('Content'));

        case 5:
        case 'end':
          return context$2$0.stop();
      }
    }, null, _this);
  });
  it('should find all elements', function callee$1$0() {
    var els;
    return _regeneratorRuntime.async(function callee$1$0$(context$2$0) {
      while (1) switch (context$2$0.prev = context$2$0.next) {
        case 0:
          context$2$0.next = 2;
          return _regeneratorRuntime.awrap(driver.elementsByXPath('//*'));

        case 2:
          els = context$2$0.sent;

          els.length.should.be.above(2);

        case 4:
        case 'end':
          return context$2$0.stop();
      }
    }, null, _this);
  });
  it('should find the first element when searching for all elements', function callee$1$0() {
    var el;
    return _regeneratorRuntime.async(function callee$1$0$(context$2$0) {
      while (1) switch (context$2$0.prev = context$2$0.next) {
        case 0:
          context$2$0.next = 2;
          return _regeneratorRuntime.awrap(driver.elementByXPath('//*'));

        case 2:
          el = context$2$0.sent;

          el.should.exist;

        case 4:
        case 'end':
          return context$2$0.stop();
      }
    }, null, _this);
  });
  it('should find less elements with compression turned on', function callee$1$0() {
    var elementsWithoutCompression, elementsWithCompression;
    return _regeneratorRuntime.async(function callee$1$0$(context$2$0) {
      while (1) switch (context$2$0.prev = context$2$0.next) {
        case 0:
          context$2$0.next = 2;
          return _regeneratorRuntime.awrap(driver.updateSettings({ "ignoreUnimportantViews": false }));

        case 2:
          context$2$0.next = 4;
          return _regeneratorRuntime.awrap(driver.elementsByXPath('//*'));

        case 4:
          elementsWithoutCompression = context$2$0.sent;
          context$2$0.next = 7;
          return _regeneratorRuntime.awrap(driver.updateSettings({ "ignoreUnimportantViews": true }));

        case 7:
          context$2$0.next = 9;
          return _regeneratorRuntime.awrap(driver.elementsByXPath('//*'));

        case 9:
          elementsWithCompression = context$2$0.sent;

          elementsWithoutCompression.length.should.be.greaterThan(elementsWithCompression.length);

        case 11:
        case 'end':
          return context$2$0.stop();
      }
    }, null, _this);
  });
  it('should find toast message element by text @skip-ci', function callee$1$0() {
    var popUpEl, searchEl, addEl;
    return _regeneratorRuntime.async(function callee$1$0$(context$2$0) {
      while (1) switch (context$2$0.prev = context$2$0.next) {
        case 0:
          context$2$0.next = 2;
          return _regeneratorRuntime.awrap(driver.startActivity({ appPackage: 'io.appium.android.apis', appActivity: '.view.PopupMenu1' }));

        case 2:
          context$2$0.next = 4;
          return _regeneratorRuntime.awrap(driver.waitForElementByAccessibilityId('Make a Popup!'));

        case 4:
          context$2$0.next = 6;
          return _regeneratorRuntime.awrap(driver.elementByAccessibilityId('Make a Popup!'));

        case 6:
          popUpEl = context$2$0.sent;
          context$2$0.next = 9;
          return _regeneratorRuntime.awrap(popUpEl.click());

        case 9:
          context$2$0.next = 11;
          return _regeneratorRuntime.awrap(driver.waitForElementByXPath('.//*[@text=\'Search\']'));

        case 11:
          context$2$0.next = 13;
          return _regeneratorRuntime.awrap(driver.elementByXPath('.//*[@text=\'Search\']'));

        case 13:
          searchEl = context$2$0.sent;
          context$2$0.next = 16;
          return _regeneratorRuntime.awrap(searchEl.click());

        case 16:
          context$2$0.next = 18;
          return _regeneratorRuntime.awrap(driver.elementByXPath('//*[@text=\'Clicked popup menu item Search\']').should.eventually.exist);

        case 18:
          context$2$0.next = 20;
          return _regeneratorRuntime.awrap(popUpEl.click());

        case 20:
          context$2$0.next = 22;
          return _regeneratorRuntime.awrap(driver.waitForElementByXPath('.//*[@text=\'Add\']'));

        case 22:
          context$2$0.next = 24;
          return _regeneratorRuntime.awrap(driver.elementByXPath('.//*[@text=\'Add\']'));

        case 24:
          addEl = context$2$0.sent;
          context$2$0.next = 27;
          return _regeneratorRuntime.awrap(addEl.click());

        case 27:
          context$2$0.next = 29;
          return _regeneratorRuntime.awrap(driver.elementByXPath('//*[@text=\'Clicked popup menu item Add\']').should.eventually.exist);

        case 29:
        case 'end':
          return context$2$0.stop();
      }
    }, null, this);
  });
});

// skip on travis, as it is too slow and the message is removed before
// we can find it
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInRlc3QvZnVuY3Rpb25hbC9jb21tYW5kcy9maW5kL2J5LXhwYXRoLWUyZS1zcGVjcy5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7Ozs7b0JBQWlCLE1BQU07Ozs7OEJBQ0ksa0JBQWtCOzs7O3VCQUNmLGVBQWU7OzhCQUNsQix1QkFBdUI7O0FBR2xELGtCQUFLLE1BQU0sRUFBRSxDQUFDO0FBQ2Qsa0JBQUssR0FBRyw2QkFBZ0IsQ0FBQzs7QUFFekIsSUFBTSxHQUFHLEdBQUcseUJBQXlCLENBQUM7QUFDdEMsSUFBTSxDQUFDLEdBQUcsNEJBQTRCLENBQUM7O0FBRXZDLFFBQVEsQ0FBQyxjQUFjLEVBQUUsWUFBWTs7O0FBQ25DLE1BQUksTUFBTSxZQUFBLENBQUM7QUFDWCxRQUFNLENBQUM7Ozs7OzJDQUNVLHVEQUF5Qjs7O0FBQXhDLGdCQUFNOzs7Ozs7O0dBQ1AsQ0FBQyxDQUFDO0FBQ0gsT0FBSyxDQUFDOzs7OzsyQ0FDRSxNQUFNLENBQUMsSUFBSSxFQUFFOzs7Ozs7O0dBQ3BCLENBQUMsQ0FBQztBQUNILElBQUUsQ0FBQyw2QkFBNkIsRUFBRTtRQUM1QixFQUFFOzs7OzsyQ0FBUyxNQUFNLENBQUMsY0FBYyxRQUFNLEdBQUcsQ0FBRzs7O0FBQTVDLFlBQUU7OzJDQUNBLEVBQUUsQ0FBQyxJQUFJLEVBQUUsQ0FBQyxNQUFNLENBQUMsVUFBVSxDQUFDLEtBQUssQ0FBQyxXQUFXLENBQUM7Ozs7Ozs7R0FDckQsQ0FBQyxDQUFDO0FBQ0gsSUFBRSxDQUFDLDZCQUE2QixFQUFFO1FBQzVCLEVBQUU7Ozs7OzJDQUFTLE1BQU0sQ0FBQyxjQUFjLFFBQU0sR0FBRywrQkFBMEI7OztBQUFuRSxZQUFFOzsyQ0FDQSxFQUFFLENBQUMsSUFBSSxFQUFFLENBQUMsTUFBTSxDQUFDLFVBQVUsQ0FBQyxLQUFLLENBQUMsZUFBZSxDQUFDOzs7Ozs7O0dBQ3pELENBQUMsQ0FBQztBQUNILElBQUUsQ0FBQyxrQ0FBa0MsRUFBRTs7Ozs7MkNBQy9CLE1BQU0sQ0FB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QUFFLGtCQUFrQixFQUFDLENBQUM7Ozs7MkNBQzdGLE1BQU0sQ0FBQywrQkFBK0IsQ0FBQyxlQUFlLENBQUM7Ozs7MkNBQ3pDLE1BQU0sQ0FBQyx3QkFBd0IsQ0FBQyxlQUFlLENBQUM7OztBQUFoRSxpQkFBTzs7MkNBRUwsT0FBTyxDQUFDLEtBQUssRUFBRTs7OzsyQ0FDZixNQUFNLENBQUMscUJBQXFCLDBCQUF3Qjs7OzsyQ0FDckMsTUFBTSxDQUFDLGNBQWMsMEJBQXdCOzs7QUFBOUQsa0JBQVE7OzJDQUNOLFFBQVEsQ0FBQyxLQUFLLEVBQUU7Ozs7MkNBQ2hCLE1BQU0sQ0FBQyxjQUFjLGlEQUErQyxDQUNyRSxNQUFNLENBQUMsVUFBVSxDQUFDLEtBQUs7Ozs7MkNBRXRCLE9BQU8sQ0FBQyxLQUFLLEVBQUU7Ozs7MkNBQ2YsTUFBTSxDQUFDLHFCQUFxQix1QkFBcUI7Ozs7MkNBQ3JDLE1BQU0sQ0FBQyxjQUFjLHVCQUFxQjs7O0FBQXhELGVBQUs7OzJDQUNILEtBQUssQ0FBQyxLQUFLLEVBQUU7Ozs7MkNBQ2IsTUFBTSxDQUFDLGNBQWMsOENBQTRDLENBQ2xFLE1BQU0sQ0FBQyxVQUFVLENBQUMsS0FBSzs7Ozs7OztHQUM3QixDQUFDLENBQUM7Q0FDSixDQUFDLENBQUMiLCJmaWxlIjoidGVzdC9mdW5jdGlvbmFsL2NvbW1hbmRzL2ZpbmQvYnkteHBhdGgtZTJlLXNwZWNzLmpzIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IGNoYWkgZnJvbSAnY2hhaSc7XG5pbXBvcnQgY2hhaUFzUHJvbWlzZWQgZnJvbSAnY2hhaS1hcy1wcm9taXNlZCc7XG5pbXBvcnQgeyBBUElERU1PU19DQVBTIH0gZnJvbSAnLi4vLi4vZGVzaXJlZCc7XG5pbXBvcnQgeyBpbml0RHJpdmVyIH0gZnJvbSAnLi4vLi4vaGVscGVycy9zZXNzaW9uJztcblxuXG5jaGFpLnNob3VsZCgpO1xuY2hhaS51c2UoY2hhaUFzUHJvbWlzZWQpO1xuXG5jb25zdCBhdHYgPSAnYW5kcm9pZC53aWRnZXQuVGV4dFZpZXcnO1xuY29uc3QgZiA9IFwiYW5kcm9pZC53aWRnZXQuRnJhbWVMYXlvdXRcIjtcblxuZGVzY3JpYmUoJ0ZpbmQgLSB4cGF0aCcsIGZ1bmN0aW9uICgpIHtcbiAgbGV0IGRyaXZlcjtcbiAgYmVmb3JlKGFzeW5jICgpID0+IHtcbiAgICBkcml2ZXIgPSBhd2FpdCBpbml0RHJpdmVyKEFQSURFTU9TX0NBUFMpO1xuICB9KTtcbiAgYWZ0ZXIoYXN5bmMgKCkgPT4ge1xuICAgIGF3YWl0IGRyaXZlci5xdWl0KCk7XG4gIH0pO1xuICBpdCgnc2hvdWxkIGZpbmQgZWxlbWVudCBieSB0eXBlJywgYXN5bmMgKCkgPT4ge1xuICAgIGxldCBlbCA9IGF3YWl0IGRyaXZlci5lbGVtZW50QnlYUGF0aChgLy8ke2F0dn1gKTtcbiAgICBhd2FpdCBlbC50ZXh0KCkuc2hvdWxkLmV2ZW50dWFsbHkuZXF1YWwoJ0FQSSBEZW1vcycpO1xuICB9KTtcbiAgaXQoJ3Nob3VsZCBmaW5kIGVsZW1lbnQgYnkgdGV4dCcsIGFzeW5jICgpID0+IHtcbiAgICBsZXQgZWwgPSBhd2FpdCBkcml2ZXIuZWxlbWVudEJ5WFBhdGgoYC8vJHthdHZ9W0B0ZXh0PSdBY2Nlc3NpYmlsaXR5J11gKTtcbiAgICBhd2FpdCBlbC50ZXh0KCkuc2hvdWxkLmV2ZW50dWFsbHkuZXF1YWwoJ0FjY2Vzc2liaWxpdHknKTtcbiAgfSk7XG4gIGl0KCdzaG91bGQgZmluZCBlbGVtZW50IGJ5IGF0dHJpYnV0ZScsIGFzeW5jICgpID0+IHtcbiAgICBhd2FpdCBkcml2ZXIuZWxlbWVudHNCeVhQYXRoKGAvLypbQGVuYWJsZWQ9J3RydWUnIGFuZCBAZm9jdXNlZD0ndHJ1ZSddYClcbiAgICAgIC5zaG91bGQuZXZlbnR1YWxseS5oYXZlLmxlbmd0aCgxKTtcbiAgfSk7XG4gIGl0KCdzaG91bGQgZmluZCBleGFjdGx5IG9uZSBlbGVtZW50IHZpYSBlbGVtZW50c0J5WFBhdGgnLCBhc3luYyAoKSA9PiB7XG4gICAgbGV0IGVscyA9IGF3YWl0IGRyaXZlci5lbGVtZW50c0J5WFBhdGgoYC8vJHthdHZ9W0B0ZXh0PSdBY2Nlc3NpYmlsaXR5J11gKTtcbiAgICBlbHMubGVuZ3RoLnNob3VsZC5lcXVhbCgxKTtcbiAgICBhd2FpdCBlbHNbMF0udGV4dCgpLnNob3VsZC5ldmVudHVhbGx5LmVxdWFsKCdBY2Nlc3NpYmlsaXR5Jyk7XG4gIH0pO1xuICBpdCgnc2hvdWxkIGZpbmQgZWxlbWVudCBieSBwYXJ0aWFsIHRleHQnLCBhc3luYyAoKSA9PiB7XG4gICAgbGV0IGVsID0gYXdhaXQgZHJpdmVyLmVsZW1lbnRCeVhQYXRoKGAvLyR7YXR2fVtjb250YWlucyhAdGV4dCwgJ0FjY2Vzc2liaWxpdHknKV1gKTtcbiAgICBhd2FpdCBlbC50ZXh0KCkuc2hvdWxkLmV2ZW50dWFsbHkuZXF1YWwoJ0FjY2Vzc2liaWxpdHknKTtcbiAgfSk7XG4gIGl0KCdzaG91bGQgZmluZCB0aGUgbGFzdCBlbGVtZW50JywgYXN5bmMgKCkgPT4ge1xuICAgIGxldCBlbCA9IGF3YWl0IGRyaXZlci5lbGVtZW50QnlYUGF0aChgKC8vJHthdHZ9KVtsYXN0KCldYCk7XG4gICAgbGV0IHRleHQgPSBhd2FpdCBlbC50ZXh0KCk7XG4gICAgW1wiT1NcIiwgXCJUZXh0XCIsIFwiVmlld3NcIiwgXCJQcmVmZXJlbmNlXCJdLnNob3VsZC5pbmNsdWRlKHRleHQpO1xuICB9KTtcbiAgaXQoJ3Nob3VsZCBmaW5kIGVsZW1lbnQgYnkgaW5kZXggYW5kIGVtYmVkZGVkIGRlc2MnLCBhc3luYyAoKSA9PiB7XG4gICAgbGV0IGVsID0gYXdhaXQgZHJpdmVyLmVsZW1lbnRCeVhQYXRoKGAvLyR7Zn0vLyR7YXR2fVs1XWApO1xuICAgIGF3YWl0IGVsLnRleHQoKS5zaG91bGQuZXZlbnR1YWxseS5lcXVhbCgnQ29udGVudCcpO1xuICB9KTtcbiAgaXQoJ3Nob3VsZCBmaW5kIGFsbCBlbGVtZW50cycsIGFzeW5jICgpID0+IHtcbiAgICBsZXQgZWxzID0gYXdhaXQgZHJpdmVyLmVsZW1lbnRzQnlYUGF0aChgLy8qYCk7XG4gICAgZWxzLmxlbmd0aC5zaG91bGQuYmUuYWJvdmUoMik7XG4gIH0pO1xuICBpdCgnc2hvdWxkIGZpbmQgdGhlIGZpcnN0IGVsZW1lbnQgd2hlbiBzZWFyY2hpbmcgZm9yIGFsbCBlbGVtZW50cycsIGFzeW5jICgpID0+IHtcbiAgICBsZXQgZWwgPSBhd2FpdCBkcml2ZXIuZWxlbWVudEJ5WFBhdGgoYC8vKmApO1xuICAgIGVsLnNob3VsZC5leGlzdDtcbiAgfSk7XG4gIGl0KCdzaG91bGQgZmluZCBsZXNzIGVsZW1lbnRzIHdpdGggY29tcHJlc3Npb24gdHVybmVkIG9uJywgYXN5bmMgKCkgPT4ge1xuICAgIGF3YWl0IGRyaXZlci51cGRhdGVTZXR0aW5ncyh7XCJpZ25vcmVVbmltcG9ydGFudFZpZXdzXCI6IGZhbHNlfSk7XG4gICAgbGV0IGVsZW1lbnRzV2l0aG91dENvbXByZXNzaW9uID0gYXdhaXQgZHJpdmVyLmVsZW1lbnRzQnlYUGF0aChgLy8qYCk7XG4gICAgYXdhaXQgZHJpdmVyLnVwZGF0ZVNldHRpbmdzKHtcImlnbm9yZVVuaW1wb3J0YW50Vmlld3NcIjogdHJ1ZX0pO1xuICAgIGxldCBlbGVtZW50c1dpdGhDb21wcmVzc2lvbiA9IGF3YWl0IGRyaXZlci5lbGVtZW50c0J5WFBhdGgoYC8vKmApO1xuICAgIGVsZW1lbnRzV2l0aG91dENvbXByZXNzaW9uLmxlbmd0aC5zaG91bGQuYmUuZ3JlYXRlclRoYW4oZWxlbWVudHNXaXRoQ29tcHJlc3Npb24ubGVuZ3RoKTtcbiAgfSk7XG4gIGl0KCdzaG91bGQgZmluZCB0b2FzdCBtZXNzYWdlIGVsZW1lbnQgYnkgdGV4dCBAc2tpcC1jaScsIGFzeW5jIGZ1bmN0aW9uICgpIHtcbiAgICAvLyBza2lwIG9uIHRyYXZpcywgYXMgaXQgaXMgdG9vIHNsb3cgYW5kIHRoZSBtZXNzYWdlIGlzIHJlbW92ZWQgYmVmb3JlXG4gICAgLy8gd2UgY2FuIGZpbmQgaXRcblxuICAgIGF3YWl0IGRyaXZlci5zdGFydEFjdGl2aXR5KHthcHBQYWNrYWdlOiAnaW8uYXBwaXVtLmFuZHJvaWQuYXBpcycsIGFwcEFjdGl2aXR5OiAnLnZpZXcuUG9wdXBNZW51MSd9KTtcbiAgICBhd2FpdCBkcml2ZXIud2FpdEZvckVsZW1lbnRCeUFjY2Vzc2liaWxpdHlJZCgnTWFrZSBhIFBvcHVwIScpO1xuICAgIGxldCBwb3BVcEVsID0gYXdhaXQgZHJpdmVyLmVsZW1lbnRCeUFjY2Vzc2liaWxpdHlJZCgnTWFrZSBhIFBvcHVwIScpO1xuXG4gICAgYXdhaXQgcG9wVXBFbC5jbGljaygpO1xuICAgIGF3YWl0IGRyaXZlci53YWl0Rm9yRWxlbWVudEJ5WFBhdGgoYC4vLypbQHRleHQ9J1NlYXJjaCddYCk7XG4gICAgbGV0IHNlYXJjaEVsID0gYXdhaXQgZHJpdmVyLmVsZW1lbnRCeVhQYXRoKGAuLy8qW0B0ZXh0PSdTZWFyY2gnXWApO1xuICAgIGF3YWl0IHNlYXJjaEVsLmNsaWNrKCk7XG4gICAgYXdhaXQgZHJpdmVyLmVsZW1lbnRCeVhQYXRoKGAvLypbQHRleHQ9J0NsaWNrZWQgcG9wdXAgbWVudSBpdGVtIFNlYXJjaCddYClcbiAgICAgICAgLnNob3VsZC5ldmVudHVhbGx5LmV4aXN0O1xuXG4gICAgYXdhaXQgcG9wVXBFbC5jbGljaygpO1xuICAgIGF3YWl0IGRyaXZlci53YWl0Rm9yRWxlbWVudEJ5WFBhdGgoYC4vLypbQHRleHQ9J0FkZCddYCk7XG4gICAgbGV0IGFkZEVsID0gYXdhaXQgZHJpdmVyLmVsZW1lbnRCeVhQYXRoKGAuLy8qW0B0ZXh0PSdBZGQnXWApO1xuICAgIGF3YWl0IGFkZEVsLmNsaWNrKCk7XG4gICAgYXdhaXQgZHJpdmVyLmVsZW1lbnRCeVhQYXRoKGAvLypbQHRleHQ9J0NsaWNrZWQgcG9wdXAgbWVudSBpdGVtIEFkZCddYClcbiAgICAgICAgLnNob3VsZC5ldmVudHVhbGx5LmV4aXN0O1xuICB9KTtcbn0pO1xuIl0sInNvdXJjZVJvb3QiOiIuLi8uLi8uLi8uLi8uLiJ9
